"use strict";var _=(i,e,t)=>new Promise((n,a)=>{var d=o=>{try{u(t.next(o))}catch(s){a(s)}},r=o=>{try{u(t.throw(o))}catch(s){a(s)}},u=o=>o.done?n(o.value):Promise.resolve(o.value).then(d,r);u((t=t.apply(i,e)).next())});var T=Object.defineProperty,R=(i,e,t)=>e in i?T(i,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):i[e]=t,l=(i,e,t)=>(R(i,typeof e!="symbol"?e+"":e,t),t),I=["deviceProperties","playerProperties","allPlaylists","currentPlaylist","playlistById","allPages","currentPage","playlistPages","playbackState","mediaById","mediaByTags","mediaInFolder","argumentValue"],C=I;function S(){return`${(Math.random()*.9+.1).toString(36).substring(2,11)}-${Date.now()}`}var b=2,h="ttv-",q=15e3,y=class{constructor(){if(l(this,"id",S()),l(this,"requestTimeout",q),l(this,"_eventHandlerSet",new Set),l(this,"_eventHandlers",new Map),l(this,"_pendingResponses",new Map),window.__TTV_SDK__)return window.__TTV_SDK__;this._installGlobals()}on(e,t){if(this._eventHandlerSet.has(t))return;this._eventHandlerSet.add(t);let n=this._eventHandlers.get(e);n||(n=new Set,this._eventHandlers.set(e,n)),n.add(t),this._sendMessage({type:"event",name:"watchersUpdate",data:Array.from(this._eventHandlers.keys())})}off(e,t){if(!this._eventHandlerSet.has(t))return;this._eventHandlerSet.delete(t);let n=this._eventHandlers.get(e);n&&(n.delete(t),n.size===0&&this._eventHandlers.delete(e),this._sendMessage({type:"event",name:"watchersUpdate",data:Array.from(this._eventHandlers.keys())}))}sendRequest(e,t,n){return _(this,null,function*(){let a=n||e;this._pendingResponses.has(a)||this._sendMessage({type:"getData",name:e,dataKey:a,data:t});let d,r=new Promise((o,s)=>{d=setTimeout(()=>{clearTimeout(d),this._pendingResponses.delete(a),s(new Error(`SDK: Request timeout for "${a}"`))},this.requestTimeout)}),u=new Promise(o=>{let s=this._pendingResponses.get(a);s||(s=new Set,this._pendingResponses.set(a,s));let p=P=>{clearTimeout(d),s==null||s.delete(p),(s==null?void 0:s.size)===0&&this._pendingResponses.delete(a),o(P)};s.add(p)});return Promise.race([r,u])})}sendCommand(e,t){this._sendMessage({type:"command",name:e,data:t})}_handleMessage(e){if(!K(this.id,e.data))return;let{name:t,data:n,dataKey:a}=e.data,d=e.data.type.replace(h,"");if(d==="data")return this._handleDataResponse(t,a,n);if(d==="event")return this._handleEvent(t,n)}_sendMessage(e){window.parent.postMessage({type:`ttvSDK-${e.type.trim()}`,source:"ttv_npm_sdk",windowId:this.id,iframeKey:window.__TTV_IFRAME_KEY,name:e.name,dataKey:e.dataKey,data:e.data},"*")}_handleDataResponse(e,t="",n){if(!C.includes(e))return console.debug(`SDK: Unknown data name "${e}"`,n);let a=t||e,d=this._pendingResponses.get(a);if(d)for(let r of d)r(n)}_handleEvent(e,t){let n=this._eventHandlers.get(e);if(n)for(let a of n)t===void 0?a():a(t)}_installGlobals(){window.__TTV_SDK_VERSION=b,window.__TTV_SDK_WINDOW_ID=this.id,window.__TTV_SDK__=this,window.addEventListener("message",e=>this._handleMessage(e),!0),this._sendMessage({type:"event",name:"ready"})}};function K(i,e){return!!e&&typeof e=="object"&&"windowId"in e&&"type"in e&&"name"in e&&"data"in e&&typeof e.windowId=="string"&&e.windowId===i&&typeof e.type=="string"&&e.type.startsWith(h)&&typeof e.name=="string"&&(!("dataKey"in e)||e.dataKey===void 0||typeof e.dataKey=="string")}var f=new y;function w(){f.sendCommand("pause")}function v(){f.sendCommand("play")}function c(i){f.sendCommand("log",i)}var E=600,m=null;function g(){m?(clearTimeout(m),c("Reset timeout.")):(w(),c("Paused due to touch event.")),m=setTimeout(()=>{v(),c("Resumed after timeout."),m=null},E)}document.addEventListener("touchstart",g);document.addEventListener("touchmove",g);document.addEventListener("touchend",g);document.addEventListener("touchcancel",g);window.onload=()=>{c("Loaded.")};
