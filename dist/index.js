"use strict";var _=(s,e,t)=>new Promise((n,a)=>{var d=o=>{try{u(t.next(o))}catch(i){a(i)}},r=o=>{try{u(t.throw(o))}catch(i){a(i)}},u=o=>o.done?n(o.value):Promise.resolve(o.value).then(d,r);u((t=t.apply(s,e)).next())});var R=Object.defineProperty,I=(s,e,t)=>e in s?R(s,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[e]=t,l=(s,e,t)=>(I(s,typeof e!="symbol"?e+"":e,t),t),C=["deviceProperties","playerProperties","allPlaylists","currentPlaylist","playlistById","allPages","currentPage","playlistPages","playbackState","mediaById","mediaByTags","mediaInFolder","argumentValue"],S=C;function b(){return`${(Math.random()*.9+.1).toString(36).substring(2,11)}-${Date.now()}`}var q=2,h="ttv-",K=15e3,y=class{constructor(){if(l(this,"id",b()),l(this,"requestTimeout",K),l(this,"_eventHandlerSet",new Set),l(this,"_eventHandlers",new Map),l(this,"_pendingResponses",new Map),window.__TTV_SDK__)return window.__TTV_SDK__;this._installGlobals()}on(e,t){if(this._eventHandlerSet.has(t))return;this._eventHandlerSet.add(t);let n=this._eventHandlers.get(e);n||(n=new Set,this._eventHandlers.set(e,n)),n.add(t),this._sendMessage({type:"event",name:"watchersUpdate",data:Array.from(this._eventHandlers.keys())})}off(e,t){if(!this._eventHandlerSet.has(t))return;this._eventHandlerSet.delete(t);let n=this._eventHandlers.get(e);n&&(n.delete(t),n.size===0&&this._eventHandlers.delete(e),this._sendMessage({type:"event",name:"watchersUpdate",data:Array.from(this._eventHandlers.keys())}))}sendRequest(e,t,n){return _(this,null,function*(){let a=n||e;this._pendingResponses.has(a)||this._sendMessage({type:"getData",name:e,dataKey:a,data:t});let d,r=new Promise((o,i)=>{d=setTimeout(()=>{clearTimeout(d),this._pendingResponses.delete(a),i(new Error(`SDK: Request timeout for "${a}"`))},this.requestTimeout)}),u=new Promise(o=>{let i=this._pendingResponses.get(a);i||(i=new Set,this._pendingResponses.set(a,i));let p=T=>{clearTimeout(d),i==null||i.delete(p),(i==null?void 0:i.size)===0&&this._pendingResponses.delete(a),o(T)};i.add(p)});return Promise.race([r,u])})}sendCommand(e,t){this._sendMessage({type:"command",name:e,data:t})}_handleMessage(e){if(!E(this.id,e.data))return;let{name:t,data:n,dataKey:a}=e.data,d=e.data.type.replace(h,"");if(d==="data")return this._handleDataResponse(t,a,n);if(d==="event")return this._handleEvent(t,n)}_sendMessage(e){window.parent.postMessage({type:`ttvSDK-${e.type.trim()}`,source:"ttv_npm_sdk",windowId:this.id,iframeKey:window.__TTV_IFRAME_KEY,name:e.name,dataKey:e.dataKey,data:e.data},"*")}_handleDataResponse(e,t="",n){if(!S.includes(e))return console.debug(`SDK: Unknown data name "${e}"`,n);let a=t||e,d=this._pendingResponses.get(a);if(d)for(let r of d)r(n)}_handleEvent(e,t){let n=this._eventHandlers.get(e);if(n)for(let a of n)t===void 0?a():a(t)}_installGlobals(){window.__TTV_SDK_VERSION=q,window.__TTV_SDK_WINDOW_ID=this.id,window.__TTV_SDK__=this,window.addEventListener("message",e=>this._handleMessage(e),!0),this._sendMessage({type:"event",name:"ready"})}};function E(s,e){return!!e&&typeof e=="object"&&"windowId"in e&&"type"in e&&"name"in e&&"data"in e&&typeof e.windowId=="string"&&e.windowId===s&&typeof e.type=="string"&&e.type.startsWith(h)&&typeof e.name=="string"&&(!("dataKey"in e)||e.dataKey===void 0||typeof e.dataKey=="string")}var f=new y;function w(){f.sendCommand("pause")}function v(){f.sendCommand("play")}function P(s){f.sendCommand("log",s)}var M=600,c=null;function m(s){P(`[Touch Timeout] ${s}`)}function g(){c?(clearTimeout(c),m("Reset timeout.")):(w(),m("Paused due to touch event.")),c=setTimeout(()=>{v(),m("Resumed after timeout."),c=null},M)}document.addEventListener("touchstart",g);document.addEventListener("touchmove",g);document.addEventListener("touchend",g);document.addEventListener("touchcancel",g);window.onload=()=>{m("Loaded.")};
